generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             Int      @id @default(autoincrement())
  email          String   @unique
  username       String
  password_hash  String
  is_verified    Boolean  @default(false)
  avatar_id      String?
  avatar_url     String?
  views_count    Int      @default(0)
  favorites_count Int     @default(0)
  watchlist_count Int     @default(0)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
  verification_codes VerificationCode[]
  settings       UserSettings?
  profile        UserProfile?
  viewing_history ViewingHistory[]
  favorites      Favorites[]
  watchlist      Watchlist[]
}

model VerificationCode {
  id         Int      @id @default(autoincrement())
  code       String
  email      String
  expires_at DateTime
  created_at DateTime @default(now())
  user       User     @relation(fields: [email], references: [email])
}

model Media {
  id              Int             @id @default(autoincrement())
  title           String
  description     String?
  release_date    DateTime?
  rating          Float           @default(0)
  views           Int             @default(0)
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  viewing_history ViewingHistory[]
  favorites       Favorites[]
  watchlist       Watchlist[]
}

model UserProfile {
  id           Int      @id @default(autoincrement())
  user_id      Int      @unique
  bio          String?
  location     String?
  website      String?
  social_links Json?
  user         User     @relation(fields: [user_id], references: [id])
}

model UserSettings {
  id                Int     @id @default(autoincrement())
  user_id           Int     @unique
  notification_email Boolean @default(true)
  notification_web  Boolean @default(true)
  privacy_profile   Boolean @default(false)
  theme             String  @default("light")
  language          String  @default("ru")
  user              User    @relation(fields: [user_id], references: [id])
}

model ViewingHistory {
  id             Int      @id @default(autoincrement())
  user_id        Int
  media_id       Int
  watch_duration Int      @default(0)
  created_at     DateTime @default(now())
  user           User     @relation(fields: [user_id], references: [id])
  media          Media    @relation(fields: [media_id], references: [id])

  @@unique([user_id, media_id], name: "user_id_media_id")
}

model Favorites {
  id         Int      @id @default(autoincrement())
  user_id    Int
  media_id   Int
  created_at DateTime @default(now())
  user       User     @relation(fields: [user_id], references: [id])
  media      Media    @relation(fields: [media_id], references: [id])

  @@unique([user_id, media_id])
}

model Watchlist {
  id         Int      @id @default(autoincrement())
  user_id    Int
  media_id   Int
  created_at DateTime @default(now())
  user       User     @relation(fields: [user_id], references: [id])
  media      Media    @relation(fields: [media_id], references: [id])

  @@unique([user_id, media_id])
}